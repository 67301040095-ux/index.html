<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3D Chiller Plant Full Version</title>
<style>
body { margin:0; overflow:hidden; background:#1e2228; }
button{
  position:fixed;
  top:20px;
  left:20px;
  padding:10px 20px;
  font-size:16px;
  z-index:10;
}
</style>
</head>
<body>

<button onclick="startSystem()">START SYSTEM</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>

// ================= SCENE =================
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
60,
window.innerWidth/window.innerHeight,
0.1,
2000
);
camera.position.set(0,150,350);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// ================= LIGHT =================
scene.add(new THREE.AmbientLight(0xffffff,0.5));

const dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(200,300,200);
dirLight.castShadow = true;
scene.add(dirLight);

// ================= GROUND =================
const ground = new THREE.Mesh(
new THREE.PlaneGeometry(600,400),
new THREE.MeshStandardMaterial({color:0xf0f0f0})
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// ================= MATERIAL =================
const equipMat = new THREE.MeshStandardMaterial({
color:0xffffff,
roughness:0.5,
metalness:0.2
});

// ================= EQUIPMENT =================
function createBox(pos,color){
const mesh = new THREE.Mesh(
new THREE.BoxGeometry(40,40,40),
new THREE.MeshStandardMaterial({color:color})
);
mesh.position.copy(pos);
mesh.position.y = 20;
mesh.castShadow = true;
mesh.receiveShadow = true;
scene.add(mesh);
}

// Layout à¸•à¸£à¸‡à¹à¸™à¸§à¸™à¸­à¸™
const CT  = new THREE.Vector3(-200,0,0);
const CDP = new THREE.Vector3(-100,0,0);
const CH  = new THREE.Vector3(0,0,0);
const CHP = new THREE.Vector3(100,0,0);
const AHU = new THREE.Vector3(200,0,0);

createBox(CT,0xdedede);
createBox(CDP,0x87a8ff);
createBox(CH,0xffffff);
createBox(CHP,0x87a8ff);
createBox(AHU,0xdedede);

// ================= BALL =================
const ball = new THREE.Mesh(
new THREE.SphereGeometry(6,32,32),
new THREE.MeshStandardMaterial({
color:0xffff00,
emissive:0xffff00,
emissiveIntensity:0.8
})
);
ball.castShadow = true;
scene.add(ball);

let pathStart, pathEnd;
let t = 0;
let speed = 0.01;
let step = 0;
let running = false;

// ================= MOVE FUNCTION =================
function moveBall(from, to, color, yFrom, yTo){

ball.material.color.set(color);
ball.material.emissive.set(color);

pathStart = new THREE.Vector3(from.x, yFrom, from.z);
pathEnd   = new THREE.Vector3(to.x, yTo, to.z);

t = 0;
running = true;
}

// ================= SEQUENCE =================
function startSystem(){
step = 1;
nextStep();
}

function nextStep(){

switch(step){

case 1: // ðŸŸ¡ CT âžœ CDP (à¹€à¸‚à¹‰à¸²à¸¥à¹ˆà¸²à¸‡)
moveBall(CT, CDP, 0xffff00, 10, 10);
break;

case 2: // ðŸŸ¡ CDP âžœ CH (à¹€à¸‚à¹‰à¸²à¸¥à¹ˆà¸²à¸‡)
moveBall(CDP, CH, 0xffff00, 10, 10);
break;

case 3: // ðŸŸ¢ CH âžœ CHP (à¸­à¸­à¸à¸¥à¹ˆà¸²à¸‡)
moveBall(CH, CHP, 0x00ff00, 10, 10);
break;

case 4: // ðŸŸ¢ CHP âžœ AHU (à¸­à¸­à¸à¸¥à¹ˆà¸²à¸‡)
moveBall(CHP, AHU, 0x00ff00, 10, 10);
break;

case 5: // ðŸ”µ AHU âžœ CH (à¹€à¸‚à¹‰à¸²à¸šà¸™)
moveBall(AHU, CH, 0x0088ff, 40, 40);
break;

case 6: // ðŸ”´ CH âžœ CT (à¸­à¸­à¸à¸šà¸™)
moveBall(CH, CT, 0xff0000, 40, 40);
break;

default:
running = false;
return;
}

}

// ================= ANIMATE =================
function animate(){
requestAnimationFrame(animate);

if(running){
t += speed;

if(t >= 1){
t = 1;
running = false;
step++;
setTimeout(nextStep,600);
}

ball.position.lerpVectors(pathStart,pathEnd,t);
}

renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
