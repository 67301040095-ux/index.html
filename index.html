<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chiller Plant Flow Ball Version</title>
<style>
body { margin:0; overflow:hidden; background:#eef1f5; }
button{
  position:fixed;
  top:20px;
  left:20px;
  padding:10px 20px;
  font-size:16px;
  z-index:10;
}
</style>
</head>
<body>

<button onclick="startSystem()">START SYSTEM</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

<script>

// ================= BASIC SCENE =================
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
60,
window.innerWidth/window.innerHeight,
0.1,
2000
);
camera.position.set(180,120,220);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping = true;

scene.add(new THREE.AmbientLight(0xffffff,0.7));

const light = new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(200,200,100);
scene.add(light);

// ================= MATERIAL =================
const whiteMat = new THREE.MeshStandardMaterial({color:0xffffff});
const metalMat = new THREE.MeshStandardMaterial({color:0xbfc5cc});
const darkMat  = new THREE.MeshStandardMaterial({color:0x555b66});
const blueMat  = new THREE.MeshStandardMaterial({color:0x2d6cdf});

// ================= GROUND =================
const ground = new THREE.Mesh(
new THREE.PlaneGeometry(600,600),
new THREE.MeshStandardMaterial({color:0xffffff})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ================= COOLING TOWER =================
function createCT(x,z){
const group = new THREE.Group();

const body = new THREE.Mesh(
new THREE.BoxGeometry(30,40,30),
whiteMat
);
body.position.y = 20;
group.add(body);

const blades = new THREE.Group();
for(let i=0;i<6;i++){
const blade = new THREE.Mesh(
new THREE.BoxGeometry(12,1,3),
darkMat
);
blade.position.x = 8;
const pivot = new THREE.Group();
pivot.add(blade);
pivot.rotation.y = (i/6)*Math.PI*2;
blades.add(pivot);
}
blades.position.y = 42;
group.add(blades);

group.position.set(x,0,z);
scene.add(group);

return blades;
}

// ================= CHILLER =================
function createChiller(x,z){
const group = new THREE.Group();

const barrel = new THREE.Mesh(
new THREE.CylinderGeometry(10,10,70,32),
whiteMat
);
barrel.rotation.z = Math.PI/2;
barrel.position.y = 15;
group.add(barrel);

group.position.set(x,0,z);
scene.add(group);
}

// ================= PUMP =================
function createPump(x,z){
const group = new THREE.Group();

const body = new THREE.Mesh(
new THREE.CylinderGeometry(6,6,10,32),
blueMat
);
body.position.y = 10;
group.add(body);

group.position.set(x,0,z);
scene.add(group);
}

// ================= AHU =================
function createAHU(x,z){
const group = new THREE.Group();

const box = new THREE.Mesh(
new THREE.BoxGeometry(60,20,25),
whiteMat
);
box.position.y = 12;
group.add(box);

group.position.set(x,0,z);
scene.add(group);
}

// ================= FLOW BALL =================
function createLoopFlow(points, color, speed){

const curve = new THREE.CatmullRomCurve3(points, true);

const ball = new THREE.Mesh(
new THREE.SphereGeometry(3,16,16),
new THREE.MeshStandardMaterial({
color:color,
emissive:color,
emissiveIntensity:1
})
);
scene.add(ball);

let t = 0;

return function(){
t += speed;
if(t>1) t=0;
ball.position.copy(curve.getPointAt(t));
}
}

// ================= LAYOUT =================
const fanCT = createCT(-150,-60);
createPump(-100,-20);
createChiller(0,-60);
createPump(60,-20);
createAHU(140,-60);

// ================= FLOW PATH =================
const ctFlow = createLoopFlow([
new THREE.Vector3(-150,5,-60),
new THREE.Vector3(-150,5,-20),
new THREE.Vector3(-100,5,-20),
new THREE.Vector3(-100,5,-60)
],0xff0000,0.003);

const chFlow = createLoopFlow([
new THREE.Vector3(0,5,-60),
new THREE.Vector3(0,5,-20),
new THREE.Vector3(60,5,-20),
new THREE.Vector3(60,5,-60)
],0x00ff00,0.003);

// ================= SYSTEM =================
let systemOn = false;
let fanSpeed = 0;

function startSystem(){
systemOn = true;
}

function animate(){
requestAnimationFrame(animate);

if(systemOn){
fanSpeed = 0.1;
ctFlow();
chFlow();
}

fanCT.rotation.y -= fanSpeed;

controls.update();
renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
