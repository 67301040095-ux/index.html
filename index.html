<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chiller Plant 3D Pro</title>
<style>
body { margin:0; overflow:hidden; }
</style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf5f5f5);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(40,30,50);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(50,50,30);
light.castShadow = true;
scene.add(light);
scene.add(new THREE.AmbientLight(0x888888));

// ===== Floor =====
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(200,200),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
floor.rotation.x = -Math.PI/2;
floor.receiveShadow = true;
scene.add(floor);

// ===== Materials =====
const metalMat = new THREE.MeshStandardMaterial({
  color:0xcccccc,
  metalness:0.8,
  roughness:0.3
});

const pumpMat = new THREE.MeshStandardMaterial({
  color:0x333366,
  metalness:0.5,
  roughness:0.6
});

// ===== Cooling Tower =====
function createCT(x,z){
  const group = new THREE.Group();

  const body = new THREE.Mesh(
    new THREE.BoxGeometry(8,6,8),
    metalMat
  );
  body.position.y = 3;
  body.castShadow = true;
  group.add(body);

  const fan = new THREE.Mesh(
    new THREE.CylinderGeometry(3,3,0.5,32),
    new THREE.MeshStandardMaterial({color:0x555555})
  );
  fan.position.y = 6.2;
  fan.rotation.x = Math.PI/2;
  group.add(fan);

  group.position.set(x,0,z);
  scene.add(group);

  return fan;
}

const fan1 = createCT(-30,-10);
const fan2 = createCT(-18,-10);

// ===== Chiller =====
function createChiller(x,z){
  const chiller = new THREE.Mesh(
    new THREE.CylinderGeometry(3,3,18,32),
    new THREE.MeshStandardMaterial({
      color:0x22aa66,
      metalness:0.7,
      roughness:0.4
    })
  );
  chiller.rotation.z = Math.PI/2;
  chiller.position.set(x,4,z);
  chiller.castShadow = true;
  scene.add(chiller);
}
createChiller(0,-5);
createChiller(0,-20);

// ===== Pump =====
function createPump(x,z){
  const base = new THREE.Mesh(
    new THREE.BoxGeometry(3,1,3),
    metalMat
  );
  base.position.set(x,0.5,z);
  base.castShadow = true;
  scene.add(base);

  const motor = new THREE.Mesh(
    new THREE.CylinderGeometry(1.5,1.5,3,32),
    pumpMat
  );
  motor.position.set(x,2.5,z);
  motor.castShadow = true;
  scene.add(motor);
}

createPump(-30,-25);
createPump(-22,-25);
createPump(-14,-25);

createPump(15,-25);
createPump(23,-25);
createPump(31,-25);

// ===== AHU =====
function createAHU(x,z){
  const ahu = new THREE.Mesh(
    new THREE.BoxGeometry(14,5,6),
    metalMat
  );
  ahu.position.set(x,2.5,z);
  ahu.castShadow = true;
  scene.add(ahu);
}
createAHU(35,-10);

// ===== 3D Pipe =====
function createPipe(start,end){
  const curve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(...start),
    new THREE.Vector3((start[0]+end[0])/2, 6, start[2]),
    new THREE.Vector3(...end)
  ]);

  const geometry = new THREE.TubeGeometry(curve, 20, 0.8, 16, false);
  const material = new THREE.MeshStandardMaterial({color:0xff9900});
  const pipe = new THREE.Mesh(geometry, material);
  pipe.castShadow = true;
  scene.add(pipe);
}

createPipe([-26,6,-10],[0,6,-5]);
createPipe([0,6,-5],[35,6,-10]);

// ===== Animation =====
function animate(){
  requestAnimationFrame(animate);

  fan1.rotation.z += 0.05;
  fan2.rotation.z += 0.05;

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>

</body>
</html>
