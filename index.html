<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Modern Chiller Plant 3D - Single Unit Version</title>
<style>
body { margin:0; overflow:hidden; background:#eef1f5; }
button{
  position:fixed;
  top:20px;
  left:20px;
  padding:10px 20px;
  font-size:16px;
  z-index:10;
}
</style>
</head>
<body>

<button onclick="startSystem()">START SYSTEM</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

<script>

// ================= SCENE =================
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
60,
window.innerWidth/window.innerHeight,
0.1,
2000
);
camera.position.set(160,100,220);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping = true;

// ================= LIGHT =================
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const light = new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(200,200,100);
scene.add(light);

// ================= MATERIAL =================
const whiteMat = new THREE.MeshStandardMaterial({color:0xffffff});
const metalMat = new THREE.MeshStandardMaterial({color:0xd0d5db});
const darkMat  = new THREE.MeshStandardMaterial({color:0x555b66});
const accentMat= new THREE.MeshStandardMaterial({color:0x2d6cdf});

// ================= GROUND =================
const ground = new THREE.Mesh(
new THREE.PlaneGeometry(600,600),
new THREE.MeshStandardMaterial({color:0xffffff})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ================= CT =================
function createCT(x,z){
const group = new THREE.Group();

const body = new THREE.Mesh(new THREE.BoxGeometry(25,40,25),whiteMat);
body.position.y = 20;
group.add(body);

const hub = new THREE.Mesh(new THREE.CylinderGeometry(2,2,2,32),darkMat);
hub.rotation.x = Math.PI/2;
hub.position.y = 45;
group.add(hub);

const blades = new THREE.Group();
for(let i=0;i<6;i++){
const blade = new THREE.Mesh(new THREE.BoxGeometry(12,1,3),darkMat);
blade.position.x = 8;
const pivot = new THREE.Group();
pivot.add(blade);
pivot.rotation.y = (i/6)*Math.PI*2;
blades.add(pivot);
}
blades.position.y = 45;
group.add(blades);

group.userData.fan = blades;
group.position.set(x,0,z);
scene.add(group);
return group;
}

// ================= CHILLER =================
function createChiller(x,z){
const group = new THREE.Group();
const body = new THREE.Mesh(new THREE.BoxGeometry(60,20,20),whiteMat);
body.position.y = 10;
group.add(body);
group.position.set(x,0,z);
scene.add(group);
return group;
}

// ================= PUMP =================
function createPump(x,z){
const group = new THREE.Group();
const body = new THREE.Mesh(new THREE.CylinderGeometry(6,6,12,32),accentMat);
body.position.y = 6;
group.add(body);
group.position.set(x,0,z);
scene.add(group);
return group;
}

// ================= AHU =================
function createAHU(x,z){
const group = new THREE.Group();

const body = new THREE.Mesh(new THREE.BoxGeometry(70,20,22),whiteMat);
body.position.y = 12;
group.add(body);

const fanGroup = new THREE.Group();
for(let i=0;i<4;i++){
const blade = new THREE.Mesh(
new THREE.BoxGeometry(1.5,12,2),
darkMat
);
blade.rotation.x = i*Math.PI/2;
fanGroup.add(blade);
}
fanGroup.rotation.y = Math.PI/2;
fanGroup.position.set(-25,12,13);
group.add(fanGroup);

group.userData.fan = fanGroup;
group.position.set(x,0,z);
scene.add(group);
return group;
}

// ================= FLOW =================
function createFlow(pathPoints, color = 0x00aaff, speed = 0.002) {

const curve = new THREE.CatmullRomCurve3(pathPoints);

const geometry = new THREE.SphereGeometry(2, 16, 16);
const material = new THREE.MeshStandardMaterial({
color: color,
emissive: color,
emissiveIntensity: 1
});

const dot = new THREE.Mesh(geometry, material);
scene.add(dot);

let t = 0;

function animateFlow() {
t += speed;
if (t > 1) t = 0;
const position = curve.getPointAt(t);
dot.position.copy(position);
}

return animateFlow;
}

// ================= CREATE SINGLE EQUIPMENT =================
const ct = createCT(-120,-60);
const cdp = createPump(-60,-20);
const ch = createChiller(0,-60);
const chp = createPump(60,-20);
const ahu = createAHU(140,-60);

// ================= FLOW PATH =================
const supplyFlow = createFlow([
new THREE.Vector3(-120, 5, -60),
new THREE.Vector3(-60, 5, -20),
new THREE.Vector3(0, 5, -60),
new THREE.Vector3(60, 5, -20),
new THREE.Vector3(140, 5, -60)
], 0xff8800, 0.001);

const returnFlow = createFlow([
new THREE.Vector3(140, 5, -60),
new THREE.Vector3(0, 5, -60),
new THREE.Vector3(-120, 5, -60)
], 0x0088ff, 0.001);

// ================= SYSTEM =================
let systemOn = false;

function startSystem(){
systemOn = true;
}

function animate(){
requestAnimationFrame(animate);

if(systemOn){

// CT fan
ct.userData.fan.rotation.y -= 0.1;

// AHU fan
ahu.userData.fan.rotation.y += 0.15;

// Flow
supplyFlow();
returnFlow();

}

controls.update();
renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
