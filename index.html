<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chiller Plant 3D</title>
<style>
body { margin:0; overflow:hidden; background:#111; }
button{
  position:fixed;
  top:20px;
  left:20px;
  padding:10px 20px;
  font-size:16px;
  z-index:10;
}
</style>
</head>
<body>

<button onclick="startSystem()">START SYSTEM</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

<script>

// ================= SCENE =================
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth/window.innerHeight,
  0.1,
  2000
);
camera.position.set(140,90,180);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);

// ================= LIGHT =================
scene.add(new THREE.AmbientLight(0x666666));

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(100,150,100);
light.castShadow = true;
scene.add(light);

// ================= MATERIAL =================
const metal = new THREE.MeshStandardMaterial({
  color:0xbfbfbf,
  metalness:0.8,
  roughness:0.4
});

const green = new THREE.MeshStandardMaterial({
  color:0x1faa59,
  metalness:0.6,
  roughness:0.4
});

const blue = new THREE.MeshStandardMaterial({
  color:0x3355ff
});

// ================= GROUND =================
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(400,400),
  new THREE.MeshStandardMaterial({color:0x222222})
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// ================= COOLING TOWER =================
function createCT(x,z){

  const group = new THREE.Group();

  const base = new THREE.Mesh(
    new THREE.BoxGeometry(22,5,22),
    metal
  );
  base.position.y = 2.5;
  group.add(base);

  const body = new THREE.Mesh(
    new THREE.BoxGeometry(18,30,18),
    metal
  );
  body.position.y = 20;
  group.add(body);

  const deck = new THREE.Mesh(
    new THREE.BoxGeometry(18,3,18),
    new THREE.MeshStandardMaterial({color:0x777777})
  );
  deck.position.y = 36;
  group.add(deck);

  const fan = new THREE.Mesh(
    new THREE.CylinderGeometry(7,7,2,32),
    new THREE.MeshStandardMaterial({color:0x333333})
  );
  fan.rotation.x = Math.PI/2;
  fan.position.y = 38;
  group.add(fan);

  group.position.set(x,0,z);
  scene.add(group);

  return fan;
}

// ================= CHILLER =================
function createChiller(x,z){
  const body = new THREE.Mesh(
    new THREE.CylinderGeometry(5,5,40,32),
    green
  );
  body.rotation.z = Math.PI/2;
  body.position.set(x,10,z);
  scene.add(body);
}

// ================= PUMP =================
function createPump(x,z){
  const base = new THREE.Mesh(
    new THREE.BoxGeometry(8,3,6),
    metal
  );
  base.position.set(x,1.5,z);
  scene.add(base);

  const motor = new THREE.Mesh(
    new THREE.CylinderGeometry(3,3,10,32),
    blue
  );
  motor.rotation.z = Math.PI/2;
  motor.position.set(x,6,z);
  scene.add(motor);
}

// ================= AHU =================
function createAHU(x,z){
  const ahu = new THREE.Mesh(
    new THREE.BoxGeometry(40,15,15),
    metal
  );
  ahu.position.set(x,8,z);
  scene.add(ahu);
}

// ================= LAYOUT =================

// CT Zone (หลังซ้าย)
const fan1 = createCT(-90,-60);
const fan2 = createCT(-60,-60);

// CDP Zone (หน้า CT)
[-95,-80,-65].forEach(x => createPump(x,-10));

// Chiller Zone (กลาง)
createChiller(0,-20);
createChiller(0,-60);

// CHP Zone (ขวา)
[50,65,80].forEach(x => createPump(x,-10));

// AHU (ขวาหลัง)
createAHU(120,-40);

// ================= SYSTEM LOGIC =================
let systemOn = false;
let fanSpeed = 0;

function startSystem(){
  setTimeout(()=>{
    systemOn = true;
  },2000);
}

// ================= ANIMATION =================
function animate(){
  requestAnimationFrame(animate);

  if(systemOn){
    fanSpeed = 0.05;
  }

  fan1.rotation.z += fanSpeed;
  fan2.rotation.z += fanSpeed;

  renderer.render(scene,camera);
}
animate();

// ================= RESIZE =================
window.addEventListener("resize",()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
